### canvas基本使用

canvas是html5的新标签，就是html上的画布。通过他，可以在上面画一些css难以实现的图案或者动画。总之，我刚开始接触到这东西，一直觉得是很高大上的东西，所以每次都下不来决心去看它，除此之外，由于canvas会导致性能上的消耗，所以之前用的也不多。但是随着5G的到来，以及硬件的升级，未来的页面，将是大量动画、短视频、以及酷炫的3D效果的天下。从淘宝以及蘑菇街等等电商平台就可以看出来。以前淘宝刚出来那会，商品能显示的清晰点的图片就很不错了，现在，几乎都有短视频介绍商品。蘑菇街的则是以主播的形式来卖东西，不过我看过蘑菇街的直播，对网速的要求还是挺高的，网速稍微慢一点，就会卡顿。但是，随着5G的到来，这些都将不是问题。说不定，用VR来1:1展示产品也会很快到来。

对于网页，要说3D的话，一下子并没有那么快速。天猫双十一前两年的邀请函就是3D的了，但是除了那个活动，网页上还是较少的。但是这是发展的趋势。········，扯远了，canvas基本的是画图，真正的大招却是实现复杂的动画，这也时很有发展趋势的。

##### canvas实现名片

最近在朋友圈，对，就是大部分是微商广告的那种朋友圈，看到很多广告的名片，是以图片的的形式存在的。原来还孤陋寡闻的以为是截屏的......。后面才知道是用canvas实现，用微信小程序的保存图片功能实现的，接下来，就以创建名片为demo，来使用基本的canvas。先上图看效果：

![1569061436717](https://github.com/yjl000/Blog/blob/master/进阶笔记/images/mingpian.png)

看起来有点丑，本来电话、地址、公司的icon都是图片的，但是为了更多的学习canvas，就用canvas创建的图形来代替的。

#### 一、个人信息区域

首先要创建canvas区域，就像画画，先得有一块画布，代码如下：

```javascript
const canvas = document.getElementById('myCanvas');
const ctx = canvas.getContext('2d');
```

这里的getContent('2d')，就是注明创建的是2d的画布，那么，当然是有3d的。

##### 1、头像等信息

首先，先设置一个信息区域的背景，代码如下：

```javascript
ctx.fillStyle = '#ffffff'; // 这里的样式对下一个fillstyle前的元素都有效
ctx.fillRect(20, 20, 297, 240);
```

这个，就是上图中的个人信息里的白色背景。ctx.fillStyle指定的是颜色，也可以加上其他的样式。ctx.fillRect()就是填充区域，前两个参数是x和y的坐标，后两位是宽和高。这样，就简单的创建了一个白色的，左上角坐标为（20,20），宽为297，高为240的矩形。单位是px。

然后，引入图片。引入图片有两种方式，一是引用网络图片，而是引用本地图片。不管是哪种方式，都要注意：图片加载完成之后才能用canvas画出来，这是一个同步的过程，否则canvas会显示一片空白。这里引入的是本地的图片：

```javascript
// 2.创建头像（引入图片）
let img  = new Image();
img.src = '../images/vatar.png';
// 确保图片加载完成（使用网络请求图片，如果加载没完成，就绘制会报错）
img.onload = function() {
  ctx.drawImage(img, 40, 40);
};
```

其他代码就不说了，ctx.drawImage就是canvas用来引入图片的，正如上面所说，要用canvas引入图片，就要在图onload之后。另外，这里又一个小小的坑需要**注意**：**drawImage的第一个参数，是img，而不是img.src**，也就是说，是img这个元素，而不是img的src属性。刚接触时很容易掉到这个坑里。第二，第三个参数就是对应的坐标了，这样，就可以把图片引入了。

之后，就是姓名和职位，这两个是文字，跟下面的其他文字是一样的，所以，这里就是canvas构建文字：

```javascript
// 3.创建名字
let name = 'KenYang';
let post = 'Web'
ctx.font = '14px 微软雅黑';
ctx.fillStyle = '#333'; // 一定要重新设置颜色，不然会引用上面的白色，也就显示不出来了
ctx.fillText(name, 110, 66);
ctx.font = '12px 微软雅黑';
ctx.fillStyle = '#999';
ctx.fillText(post, 110, 86);
```

从代码中可以看到，设置了文字变量之后，用canvas的ctx.fillText()就可以绘制到canvas上了，fillText也有三个参数，第一个是文字内容，第二第三个是坐标。需要注意的是，如果要设置不同的样式，那么在使用fillText之前要用fillStyle设置一遍，否则会一直往上找到有fillStyle的地方并使用这个样式。这样就完成了头像、名字、职位的绘制了。

这些都相对简单，只是一些坐标的移动。下面说一些相对复杂点的绘图——绘制路线，也就是上图中的地址和电话的icon。

首先，是公司名的icon，就是那个笑脸，本来这应该是一个图片的，但是为了更多的了解canvas的api，所以我们用绘图来代替。先看代码：

```javascript
// 绘制笑脸logo
ctx.beginPath();
ctx.arc(65, 125, 16, 0, Math.PI*2, true); // 脸  以（65， 125）为圆心，16为半径，逆时针画一个满圆。
ctx.moveTo(73, 125); // 将画笔提起，在（73, 125）处落下
ctx.arc(65, 125, 8, 0, Math.PI, false); // 口   以（65, 125）为圆心，8位半径，顺时针画一个半圆；
ctx.moveTo(61, 118);
ctx.arc(58, 118, 3, 0, Math.PI*2, true); // 左眼
ctx.moveTo(75, 118);
ctx.arc(72, 118, 3, 0, Math.PI*2, false); // 右眼；
ctx.stroke(); // 这里的才是显示的边框线条轮廓，之前的只是画出图形而已
ctx.closePath();
```

这段代码的beginPath()，就是路线的开始，这是必须要调用的函数，不然后面的操作都是没有作用的，我们把这步操作看成创建绘制路线的笔，有笔才可以画出路线。接下来绘制一个大的圆。arc这个api就是用来创建一个圆，它的前两位参数是圆心，第三位参数是半径，第四第五个参数是表示画的是一个半圆还是一个全圆。如果第五个参数是2π，那就是全圆，如果是π，那就是半圆。就是脸和嘴的路线。最后一个参数则表示是逆时针还是顺时针来画这个圆。这个逆时针和顺时针，如果要画的是一个满圆，顺逆都可以，但是如果是半圆，那就要区分，比如，这里的嘴巴，按顺时针是笑的，按逆时针就是哭的了。

另外要注意的一个点就是moveTo()这个方法，看字面的意思我们就知道，是移动到某处的意思。如果不写着方法，那图形的连接处就会有痕迹。比如注释掉第一个moveTo()，效果是这样的：

![1569229712383](https://github.com/yjl000/Blog/blob/master/进阶笔记/images/1569229712383.png)





就是脸和嘴角的横线，所以，你可以把moveTo这样理解，就是画完一条路线之后，把笔拿起来移动到指定位置在下笔继续画。

按照这些步骤，可以把一张简化的脸画出来。最后的两部，stroke()和closePath()，stroke类似于前面的fillRect()，就是把刚刚的路线用颜色显示出来。closePath()就是结束了这次路线的绘制。

接下来，是电话的icon，就是一个三角形，代码如下：

```javascript
// 三角形logo
ctx.beginPath();
ctx.moveTo(54, 168);  // 最左边的点
ctx.lineTo(68, 150);  // 上顶点
ctx.lineTo(68, 186); // 下顶点
ctx.fill(); // 填充
```

这里与画圆的区别就是圆用arc，而直线用lineTo。最后的这个fill()，可以说是stroke和closePath()的结合，用了这个可以不用closePath()来结束路线的绘制，fill()会自动结束。

再接着，就是地址的icon。一个渐变色的小正方形，也叫线性渐变。同样先看代码：

```javascript
// 线性渐变logo 
const lingrad = ctx.createLinearGradient(54, 200, 54, 220);
lingrad.addColorStop(0, '#00ABEB');
lingrad.addColorStop(1, '#fff');
ctx.fillStyle = lingrad;
ctx.fillRect(54,200,20,20);
ctx.font = '12px 微软雅黑';
ctx.fillStyle = '#333';
ctx.fillText(address, 84, 212);
```

先用createLinearGradient创建对象，这个对象包含4个参数，前面两个是渐变的起点的坐标，后面两个是渐变的终点的坐标。接着用addColorStop()来添加渐变的颜色，addColorStop包含两个参数，第一个是颜色对应的区域，范围是0到1，第二个参数是颜色。如上面的代码，表示渐变起点色是‘#00ABEB’，渐变终点色是‘#fff'，在这个颜色范围内渐变。

最后把这个渐变色通过fillStyle和fillRect填充到对应的区域内，就跟前面设置白色背景一样，只是这里是渐变色而已。这里要注意的是，createLinearGradient里的参数并不是渐变区域的大小，这是一条渐变色的直线，最后的fillRect才是渐变的区域，所以这两个部分要重合起来，简单的说，就是渐变的直线要跟fillRect画出的矩形的左边线重合，且高度一样，这样才会绘制出一个完整的渐变色，如果createLinearGradient对象的线条比fillRect端，那会有一部分空白，反之渐变色则会溢出，而且溢出部分不可见，就会达不到想要的渐变效果（比如只看到0到0.6的渐变区域）。

最后，就是一个推广自己软件的区域，像小程序的话，一般就是自己小程序的小程序码，保存我图片之后长按可以识别。这里，用的也是渐变，之前的是线性渐变，这里的是径向渐变，就是圆的渐变。同样先看代码：

```javascript
let radgrad = ctx.createRadialGradient(105,450,16,110,460,60);
radgrad.addColorStop(0, '#A7D30C');
radgrad.addColorStop(0.9, '#019F62');
radgrad.addColorStop(1, 'rgba(1,159,98,0)');
ctx.fillStyle = radgrad;
ctx.fillRect(30,380,150, 150);
```

这里的createRadialGradient比createLinearGradient要多两个参数，createRadialGradient的前两个参数表示的圆心坐标，第三个表示的是半径，第四第五个表示是的也是一个圆心坐标，第六个表示的是半径。也就是说，这是两个渐变的圆，而且，最后一个addColorStop必须是rgba()，并且透明度设置为0，不然的话，最外层的就不是一个圆，这是因为这个渐变的圆，采用的是用透明度来实现一个圆，和之前的arc画圆是不一样的，多尝试一下就可以明白了。和线性渐变一样，绘制完渐变，也是需要通过fillStyle和fillRect填充到特定大小的区域里。

再把对应的文字按照最开始的绘制文字的方法，就可以完成一个简单的由canvas绘制成的名片了。这里没有什么很深奥的东西，但是一些简单的api的调用。有一点要说明，可能也是很多人一开始不太愿意用，就是层级的问题，除了引入的图片（或者视频），**canvas会按照先后顺序，先绘制出来再下面，后面绘制出来的在上面**。比如上面的个人信息区域，先绘制白色背景的矩形，再绘制其他文字和图案，这样，文字和图案就在白色矩形的上面。

这就是canvas的基本使用，当然他还有很多复杂的使用，比如动画就是很常用的，下一次，就一起探讨一下canvas实现动画。

